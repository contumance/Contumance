<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>The Daily Chord ‚Äî The Harmony Oracle</title>
  <meta name="description" content="Un acorde por d√≠a como inspiraci√≥n creativa, con la est√©tica y estructura de The Scales Book." />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>‚ô™</text></svg>">
  <style>
    /* === Paleta y tipograf√≠a compartida con The Scales Book === */
    :root{
      --paper:#f5f1e8;      /* fondo papel */
      --ink:#2f2a1e;        /* texto principal */
      --muted:#6b6253;      /* texto secundario */
      --link:#2d5842;       /* enlaces */
      --link-visited:#514f7a;
      --accent:#a08a63;     /* bordes y separadores */
      --rule:#d8d2c2;       /* l√≠neas internas */
      --accent-soft:#7f7a6b;/* marcadores secundarios */
      --maxw:42rem;         /* ancho de lectura */
      --radius:14px;        /* radios */
      --lh:1.6;             /* interlineado */
      --fs-base:18px;       /* tama√±o base */
    }
    html.theme-dark{
      --paper:#10110f; --ink:#dbd6c9; --muted:#a39c8c; --link:#a9d0b8; --link-visited:#c0b8e0;
      --accent:#2a2b27; --rule:#2a2b27; --accent-soft:#7f7a6b;
    }
    html{font-size:var(--fs-base)}
    body{margin:0;padding:0;color:var(--ink);background:var(--paper);
      font-family:ui-serif, Georgia, "Iowan Old Style", "Palatino Linotype", Palatino, serif;
      line-height:var(--lh); text-rendering:optimizeLegibility; -webkit-font-smoothing:antialiased;}
    /* Textura sutil tipo papel (igual al libro de escalas) */
    body::before{content:"";position:fixed;inset:0;pointer-events:none;opacity:.06;
      background-image:radial-gradient(circle at 25% 15%, #000 .5px, transparent .5px),
                       radial-gradient(circle at 75% 85%, #000 .5px, transparent .5px);
      background-size:3px 3px,3px 3px;mix-blend-mode:multiply}

    main{max-width:var(--maxw);margin:0 auto;padding:7vh 1.25rem 4rem}

    /* Topbar + breadcrumb + toggle tema */
    .topbar{display:flex;align-items:center;justify-content:space-between;gap:1rem;margin-bottom:1rem}
    nav.breadcrumb{font-size:.95rem}
    nav.breadcrumb a{color:var(--link);text-decoration:none;text-underline-offset:2px}
    .theme-toggle{border:1px solid var(--accent);background:transparent;color:var(--ink);
      border-radius:.45rem;padding:.35rem .55rem;cursor:pointer;font-size:1.15rem;line-height:1}
    .theme-toggle:focus-visible{outline:2px dashed var(--accent);outline-offset:2px}

    h1{margin:.2rem 0 .3rem 0;font-weight:600;font-size:clamp(1.6rem,4vw,2.2rem)}
    .subtitle{color:var(--muted);font-size:.95rem;margin-bottom:.8rem}

    hr{border:none;border-top:1px solid var(--accent);margin:1.25rem 0;opacity:.5}

    /* Panel colapsable reutilizado para los controles del or√°culo */
    details.panel{border:1px solid var(--accent);border-radius:.6rem;background:rgba(255,255,255,.6)}
    html.theme-dark details.panel{background:rgba(0,0,0,.1)}
    details.panel>summary{cursor:pointer;list-style:none;padding:.6rem .8rem;font-size:.95rem;font-weight:600;color:var(--ink)}
    details.panel>summary::-webkit-details-marker{display:none}
    details.panel .panel-body{padding:.6rem .8rem .9rem}

    .controls{display:grid;gap:8px;align-items:center;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));margin-bottom:8px}
    .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    label{font-size:12px;opacity:.9}
    select,button,input[type="date"]{appearance:none;border:1px solid var(--accent);background:transparent;color:var(--ink);
      padding:10px 12px;border-radius:.5rem;font-family:inherit;font-size:14px;line-height:1;min-width:0}
    button.primary{background:var(--ink);color:var(--paper);border-color:var(--ink)}

    /* Tarjeta resultado visual coherente con el libro */
    .result{border:1px solid var(--accent);border-radius:.6rem;padding:.9rem .9rem 1rem;background:transparent}
    .kicker{font-size:.78rem;letter-spacing:.08em;text-transform:uppercase;color:var(--muted)}
    .big{font-weight:700;letter-spacing:.02em;font-size:clamp(2.2rem,6vw,3rem);line-height:1.08;margin:.2rem 0 .1rem}
    .meta{display:flex;gap:.5rem;flex-wrap:wrap;margin:.35rem 0}
    .tag{border:1px solid var(--accent);border-radius:999px;padding:.2rem .55rem;font-size:.8rem;color:var(--muted)}
    .mood{color:var(--muted);font-size:.95rem;margin-top:.2rem}

    /* Pie y hook al diapas√≥n */
    .foot{margin:30px 0 60px;font-size:12px;color:var(--muted)}
    .hook{border:1px dashed var(--accent);border-radius:.6rem;padding:.6rem .8rem;font-size:.85rem;color:var(--muted)}

    /* Animaci√≥n link coherente */
    @media (prefers-reduced-motion:no-preference){
      a{position:relative;background-image:linear-gradient(currentColor,currentColor);background-position:0 100%;background-repeat:no-repeat;background-size:0% 1px;transition:background-size .25s ease,color .2s ease}
      a:hover,a:focus-visible{background-size:100% 1px;outline:none}
    }
    /* === Diapas√≥n compacto para referencia visual === */
    .fretcard{border:1px solid var(--accent);border-radius:.6rem;padding:.9rem;background:transparent;margin-top:12px}
    #fretboard{overflow:auto}
    .fret svg{max-width:100%;height:auto;display:block}
    .legend{color:var(--muted);font-size:.8rem;margin-top:.5rem}
    .fb-grid line{stroke:var(--rule);stroke-width:1}
    .fb-grid .nut{stroke:var(--ink);stroke-width:3}
    .fb-note{fill:var(--ink)}
    .fb-note text{font-size:10px;font-weight:700;fill:var(--paper)}
  </style>
</head>
<body>
  <main>
    <div class="topbar">
      <nav class="breadcrumb" aria-label="Miga de pan">
        <a href="index.html">‚Üê Volver al √≠ndice</a>
      </nav>
      <button class="theme-toggle" id="themeToggle" type="button" aria-label="Cambiar tema" title="Cambiar tema">üåì</button>
    </div>

    <header>
      <h1>The Daily Chord ‚Äî The Harmony Oracle</h1>
      <div class="subtitle">Un acorde por d√≠a, con la misma est√©tica y estructura que el libro de escalas.</div>
    </header>

    <details class="panel" open>
      <summary>Controles</summary>
      <div class="panel-body">
        <div class="controls" role="group" aria-label="Controles del or√°culo">
          <div class="row">
            <button id="btnToday" class="primary" type="button">Hoy</button>
            <button id="btnRandom" type="button">Aleatorio</button>
            <button id="btnShare" type="button">Compartir / Copiar</button>
          </div>
          <div class="row">
            <label for="pickDate">Probar otra fecha:</label>
            <input type="date" id="pickDate" />
            <button id="btnGo" type="button">Ver</button>
          </div>
          <div class="row" style="gap:6px">
            <span class="tag" id="notationTag" title="Notaci√≥n usada">Notaci√≥n: Do‚ÄìRe‚ÄìMi</span>
          </div>
        </div>
        <section class="fretcard" aria-label="Diapas√≥n con el acorde">
  <div class="kicker">Diapas√≥n</div>
  <div id="fretboard"></div>
  <div class="legend">R = ra√≠z ¬∑ 3/b3 ¬∑ 5 ¬∑ 7/b7 (se muestran las notas del acorde dentro de una ventana de trastes).</div>
</section>
      </div>
    </details>

    <section class="result" aria-live="polite">
      <div class="kicker" id="dateLabel">Hoy</div>
      <div class="big" id="chordText">‚Äî</div>
      <div class="meta" id="metaTags"></div>
      <p class="mood" id="moodLine">‚Äî</p>
    </section>

    <p class="foot">¬© HEXES ‚Äî ‚ÄúSantuario del Colapso Industrial‚Äù. Minimal, oscuro, funcional. Este or√°culo comparte estilos, rejillas, tipograf√≠as y controles con <em>The Scales Book</em> para una est√©tica com√∫n.</p>
  </main>

  <!-- === Scripts compartidos / toggle de tema (id√©ntico a Scales) === -->
  <script>
    (function(){
      var KEY='theme-preference';
      var root=document.documentElement; var btn=document.getElementById('themeToggle');
      function apply(mode){ root.classList.toggle('theme-dark', mode==='dark'); btn.textContent='‚óë'; }
      function preferred(){ var s=localStorage.getItem(KEY); if(s==='light'||s==='dark') return s; return (window.matchMedia&&window.matchMedia('(prefers-color-scheme: dark)').matches)?'dark':'light'; }
      var current = preferred(); apply(current);
      btn.addEventListener('click', function(){ current = current==='dark'?'light':'dark'; localStorage.setItem(KEY,current); apply(current); });
    })();
  </script>

  <!-- === L√≥gica del or√°culo (portada y adaptada del prototipo original) === -->
  <script>
    // Utilidades calendario y mapeos (id√©nticos conceptualmente al prototipo)
    var WEEKDAY_ES=["Domingo","Lunes","Martes","Mi√©rcoles","Jueves","Viernes","S√°bado"];
    var WEEKDAY_ROOT={"Lunes":"Do","Martes":"Re","Mi√©rcoles":"Mi","Jueves":"Fa","Viernes":"Sol","S√°bado":"La","Domingo":"Si"};
    function monthFamily(m){ if(m>=1&&m<=3) return 'mayor'; if(m>=4&&m<=6) return 'menor'; if(m>=7&&m<=9) return 'disminuido'; return 'dominante'; }
    function dayOfYear(d){ var s=new Date(d.getFullYear(),0,1); return Math.floor((d-s)/86400000)+1; }
    var TENSION_MAP=["triada","7","9","11","13","add9","maj7","sus4","mMaj7"]; // n%9
    var ALTER_MAP=["‚ô≠9","‚ôØ9","‚ô≠5","‚ôØ11","‚ô≠13","add11","(sin alteraciones)"]; // n%7
    var INVERSION_MAP=["posici√≥n ra√≠z","1¬™ inversi√≥n","2¬™ inversi√≥n"]; // n%3
    var FAMILY_MOODS={
      mayor:"Claridad y expansi√≥n. Ideal para abrir progresiones.",
      menor:"Introspecci√≥n y movimiento interno. Textura emotiva.",
      disminuido:"Misterio y tensi√≥n. Puente dram√°tico / crom√°tico.",
      dominante:"Decisi√≥n y empuje. Tensi√≥n lista para resolver."
    };

    function buildChordSymbol(root,family,nDay){
      var tSel=TENSION_MAP[nDay%9]; var aSel=ALTER_MAP[nDay%7]; var inv=INVERSION_MAP[nDay%3];
      var quality=""; var extensions=[]; var alterations=[]; var symbol=root;
      function pushExt(e){ if(e && e!=="triada" && e!=="sus4" && e!=="mMaj7") extensions.push(e); }
      if(family==='mayor'){
        if(tSel==='maj7') quality='maj7'; else if(tSel==='add9') quality='add9'; else if(tSel==='sus4') quality='sus4'; else quality='';
        if(["9","11","13"].includes(tSel)) pushExt(tSel);
      }else if(family==='menor'){
        if(tSel==='mMaj7') quality='mMaj7';
        else if(["7","9","11","13"].includes(tSel)){ quality='m7'; pushExt(tSel==='7'?"":tSel); }
        else if(tSel==='add9') quality='madd9'; else quality='m';
      }else if(family==='disminuido'){
        if(tSel==='mMaj7') quality='mMaj7';
        else if(["9","11","13","7"].includes(tSel)){ quality='m7‚ô≠5'; pushExt(tSel==='7'?"":tSel); }
        else quality='dim7';
      }else{
        if(tSel==='sus4') quality='7sus4';
        else if(["11","13","9","7"].includes(tSel)){ quality='7'; pushExt(tSel==='7'?"":tSel); }
        else quality='7';
      }
      if(aSel && aSel!=="(sin alteraciones)") alterations.push(aSel);
      symbol=root + (quality||"") + (extensions.filter(function(e){return e&&e!=="7"}).join("")) + (alterations.join(""));
      return {root:root,family:family,quality:quality,extensions:extensions.filter(function(e){return e&&e!=="7"}),alterations:alterations,inversion:inv,symbol:symbol};
    }
    function rootFromWeekday(d){ return WEEKDAY_ROOT[ WEEKDAY_ES[d.getDay()] ]; }

    // Refs UI
    var $=function(s){return document.querySelector(s)};
    var dateLabel=$('#dateLabel'); var chordText=$('#chordText'); var metaTags=$('#metaTags'); var moodLine=$('#moodLine'); var fretMsg=$('#fretMsg'); var inputDate=$('#pickDate');
    function tagsRender(items){ metaTags.innerHTML=''; items.forEach(function(t){ var el=document.createElement('span'); el.className='tag'; el.textContent=t; metaTags.appendChild(el); }); }
    function formatDateLong(d){ return d.toLocaleDateString('es-UY',{weekday:'long',year:'numeric',month:'long',day:'numeric'}); }

    function computeForDate(d){
      var n=dayOfYear(d); var root=rootFromWeekday(d); var fam=monthFamily(d.getMonth()+1); var built=buildChordSymbol(root,fam,n);
      dateLabel.textContent=formatDateLong(d); chordText.textContent=built.symbol;
      tagsRender([ 'D√≠a '+n, 'Familia: '+fam, 'Inversi√≥n: '+built.inversion ]);
      moodLine.textContent=FAMILY_MOODS[fam];
      // Render del diapas√≥n inline
      renderFretboard(built.root, built.family, built.quality, n);
      // Evento opcional si hay integraci√≥n externa
      window.dispatchEvent(new CustomEvent('oracle-chord',{detail:{
        date:d.toISOString().slice(0,10), dayOfYear:n, root:built.root, family:built.family, quality:built.quality,
        extensions:built.extensions, alterations:built.alterations, inversion:built.inversion, symbol:built.symbol
      }}));
    }}));
      fretMsg.style.opacity=.9;
    }

    // Controles
    $('#btnToday').addEventListener('click', function(){ computeForDate(new Date()); });
    $('#btnRandom').addEventListener('click', function(){ var y=(new Date()).getFullYear(); var start=new Date(y,0,1); var rnd=Math.floor(Math.random()*365); var d=new Date(start.getTime()+rnd*86400000); inputDate.value=d.toISOString().slice(0,10); computeForDate(d); });
    $('#btnGo').addEventListener('click', function(){ var v=inputDate.value; if(!v){ alert('Eleg√≠ una fecha.'); return;} var d=new Date(v+'T12:00:00'); computeForDate(d); });
    $('#btnShare').addEventListener('click', function(){ var title='El Acorde del D√≠a ‚Äî The Harmony Oracle'; var text=chordText.textContent+' ¬∑ '+dateLabel.textContent; if(navigator.share){ navigator.share({title:title,text:text}).catch(function(){}); } else { (navigator.clipboard? navigator.clipboard.writeText(title+'\n'+text): Promise.reject()).then(function(){ alert('Copiado al portapapeles.');}).catch(function(){ alert(text);}); }});

    // Init
    (function init(){ var t=new Date(); inputDate.value=t.toISOString().slice(0,10); computeForDate(t); })();
  </script>
</body>
</html>