<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title data-i18n="doc_title">Re:sonance — A quiet selection for curious hands.</title>
  <meta name="description" content="Re:sonance — An experimental library of sound, color, and quiet motion. Paths of vibration that awaken new forms of listening." data-i18n-attr="content" data-i18n="doc_description" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>☰</text></svg>">
  <style>
    :root{
      --paper:#f5f1e8; --ink:#2f2a1e; --muted:#6b6253; --link:#2d5842;
      --link-visited:#514f7a; --accent:#a08a63; --maxw:42rem; --lh:1.6; --fs-base:18px;
      --btn-bg: transparent; --btn-ink: var(--ink); --btn-border: var(--accent);
      --btn-bg-hover: color-mix(in oklab, var(--accent) 14%, transparent);
      --btn-shadow: 0 1px 0 rgba(0,0,0,.06);
    }
    html.theme-dark{
      --paper:#0e0f0e; --ink:#dbd6c9; --muted:#9b9689; --link:#a9d0b8;
      --link-visited:#c0b8e0; --accent:#242523;
      --btn-bg: transparent; --btn-ink: var(--ink); --btn-border: var(--accent);
      --btn-bg-hover: color-mix(in oklab, var(--accent) 25%, transparent);
      --btn-shadow: 0 1px 0 rgba(0,0,0,.3);
    }
    html{font-size:var(--fs-base)}
    body{
      margin:0; color:var(--ink); background:var(--paper);
      font-family:ui-serif, Georgia, "Iowan Old Style","Palatino Linotype", Palatino, serif;
      line-height:var(--lh); text-rendering:optimizeLegibility; -webkit-font-smoothing:antialiased;
    }
    body::before{
      content:""; position:fixed; inset:0; pointer-events:none; opacity:.06;
      background-image:
        radial-gradient(circle at 25% 15%, #000 .5px, transparent .5px),
        radial-gradient(circle at 75% 85%, #000 .5px, transparent .5px);
      background-size:3px 3px, 3px 3px; mix-blend-mode:multiply;
    }
    main{max-width:var(--maxw); margin:0 auto; padding:9vh 1.25rem 4rem}

    header.header{display:flex; align-items:flex-start; justify-content:space-between; gap:1rem}
    header h1{font-weight:600; margin:0 0 .25rem 0; font-size:clamp(1.8rem,4vw,2.4rem); letter-spacing:.2px}
    header p.desc{margin:0 0 2rem 0; color:var(--muted); font-style:italic}

    .controls{display:flex; gap:.5rem; align-items:center}

    .theme-toggle{
      border:1px solid var(--accent); background:transparent; color:var(--ink);
      border-radius:.45rem; padding:.35rem .55rem; cursor:pointer; font-size:1.05rem; line-height:1
    }
    .theme-toggle:focus-visible{outline:2px dashed var(--accent); outline-offset:2px}

    .lang-select{
      border:1px solid var(--accent); background:var(--btn-bg); color:var(--ink);
      border-radius:.45rem; padding:.3rem .5rem; font-size:.95rem; line-height:1;
      appearance:none; cursor:pointer;
      background-image: linear-gradient(transparent,transparent), linear-gradient(transparent,transparent);
    }
    .lang-select:focus-visible{outline:2px dashed var(--accent); outline-offset:2px}

    hr{border:none; border-top:1px solid var(--accent); margin:1.5rem 0; opacity:.5}

    nav h2{
      font-size:1rem; font-weight:600; text-transform:uppercase; color:var(--muted);
      margin:0 0 .5rem 0; letter-spacing:.08em
    }
    ul.index{list-style:none; padding:0; margin:0}
    ul.index li{padding:0}
    ul.index li+li{border-top:1px dotted var(--accent)}

    a{color:var(--link); text-decoration:none; text-underline-offset:2px}
    a:visited{color:var(--link-visited)}

    .item{
      display:grid;
      grid-template-columns: 1.6rem 1fr;
      grid-template-areas:
        "icon title"
        "icon meta";
      column-gap:.75rem; row-gap:.2rem; align-items:center;
      padding:.85rem 0; width:100%;
    }
    .item:focus-visible{outline:2px dashed var(--accent); outline-offset:2px}
    .item:hover .title,.item:focus-visible .title{text-decoration:underline}

    .icon{grid-area:icon; width:1.15rem; height:1.15rem; margin:0; color:currentColor; opacity:.9}
    .title{grid-area:title; line-height:1.25}
    .meta{grid-area:meta; color:var(--muted); font-size:.95rem; margin-top:.1rem}

    footer{
      display:flex; flex-direction:column; align-items:center; gap:.25rem;
      font-size:.9rem; opacity:.9; padding:1.5rem 0;
    }
    footer .btn{
      display:inline-flex; align-items:center; gap:.5rem; text-decoration:none;
      border:1px solid var(--accent); border-radius:999px; padding:.45rem .95rem;
      font-size:.9rem; font-weight:500;
      transition:background-color .25s ease, color .25s ease, transform .1s ease, filter .2s ease;
    }
    html:not(.theme-dark) footer .btn{
      background:color-mix(in oklab, var(--accent) 10%, var(--paper) 90%); color:var(--ink);
    }
    html:not(.theme-dark) footer .btn:hover{
      background:color-mix(in oklab, var(--accent) 20%, var(--paper) 80%);
    }
    html.theme-dark footer .btn{
      background:color-mix(in oklab, var(--accent) 40%, var(--ink) 60%); color:var(--paper);
    }
    html.theme-dark footer .btn:hover{
      background:color-mix(in oklab, var(--accent) 55%, var(--ink) 45%);
    }
    footer .btn .btn-icon{width:1.2rem; height:1.2rem; stroke:currentColor;}
    footer .note{font-size:.85rem;color:var(--muted)}
    footer .byline{font-size:.75rem;opacity:.7}
    footer .byline em{font-style:italic;letter-spacing:.02em}

    @media (prefers-reduced-motion:no-preference){
      a{position:relative; background-image:linear-gradient(currentColor, currentColor);
        background-position:0 100%; background-repeat:no-repeat; background-size:0% 1px;
        transition:background-size .25s ease, color .2s ease, background-color .2s ease, transform .08s ease}
      a:hover, a:focus-visible{background-size:100% 1px; outline:none}
      ul.index li{transition:transform .12s ease}
      ul.index li:hover{transform:translateX(2px)}
      .btn{transition:background-color .2s ease, transform .06s ease}
      .btn:hover{transform:translateY(-1px)}
      .btn:active{transform:translateY(0)}
    }
  </style>
</head>
<body>
  <main>
    <header class="header">
      <div>
        <h1>Re:sonance</h1>
        <p class="desc" data-i18n="tagline">A quiet selection for curious hands.</p>
      </div>
      <div class="controls">
        <label class="visually-hidden" for="langSelect" data-i18n="lang_label" style="position:absolute;left:-9999px;">Language</label>
        <select id="langSelect" class="lang-select" aria-label="Language" title="Language">
          <option value="en">EN</option>
          <option value="es">ES</option>
          <option value="pt">PT</option>
        </select>
        <button class="theme-toggle" id="themeToggle" type="button" aria-label="Toggle theme" title="Toggle theme">☾</button>
      </div>
    </header>

    <hr>

    <nav aria-label="Library">
      <h2 data-i18n="collection">Collection</h2>
      <ul class="index">

        <!-- SCALES -->
        <li>
          <a class="item" href="the-scales-book.html">
            <svg class="icon" viewBox="0 0 24 24" aria-hidden="true" fill="currentColor">
              <circle cx="5" cy="16" r="1.6"></circle>
              <circle cx="9.5" cy="13.2" r="1.6"></circle>
              <circle cx="14" cy="10.6" r="1.6"></circle>
              <circle cx="18.5" cy="8" r="1.6"></circle>
            </svg>
            <span class="title" data-i18n="app_scales_title">The Scales Book</span>
            <span class="meta" data-i18n="app_scales_meta">Paths that guide the hand toward unseen colors.</span>
          </a>
        </li>

        <!-- CHORDS -->
        <li>
          <a class="item" href="the-chords-book.html">
            <svg class="icon" viewBox="0 0 24 24" aria-hidden="true" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="6" cy="17" r="2.4"></circle>
              <circle cx="18" cy="17" r="2.4"></circle>
              <circle cx="12" cy="7" r="2.4"></circle>
              <path d="M7.9 16.2 L10.4 8.8 M16.1 16.2 L13.6 8.8" />
            </svg>
            <span class="title" data-i18n="app_chords_title">The Chords Book</span>
            <span class="meta" data-i18n="app_chords_meta">Forms of resonance across the strings.</span>
          </a>
        </li>

        <!-- DAILY CHORD -->
        <li>
          <a class="item" href="the-daily-chord.html">
            <svg class="icon" viewBox="0 0 24 24" aria-hidden="true" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
              <rect x="3.5" y="6" width="17" height="13" rx="1.8"></rect>
              <path d="M7 4 v3 M17 4 v3 M3.5 9 h17" />
              <path d="M12 13.1 v-1.7 M12 13.1 l1.15 1.15 M12 13.1 l-1.15 1.15 M12 13.1 v1.7" />
            </svg>
            <span class="title" data-i18n="app_daily_title">The Daily Chord</span>
            <span class="meta" data-i18n="app_daily_meta">Each day, a chord — seen anew, to awaken inspiration.</span>
          </a>
        </li>

        <!-- BOUNCE GARDEN -->
        <li>
          <a class="item" href="the-bounce-garden.html">
            <svg class="icon" viewBox="0 0 24 24" aria-hidden="true" fill="none" stroke="currentColor" stroke-width="1.5">
              <circle cx="12" cy="12" r="9" />
              <circle cx="8" cy="10" r="1.2" />
              <circle cx="16" cy="14" r="1.2" />
            </svg>
            <span class="title" data-i18n="app_bounce_title">The Bounce Garden</span>
            <span class="meta" data-i18n="app_bounce_meta">Where collisions sing — melodic orbits and rhythmic echoes within a circle.</span>
          </a>
        </li>

        <!-- MODAL ARCHITECT -->
        <li>
          <a class="item" href="modal-architect.html">
            <svg class="icon" viewBox="0 0 24 24" aria-hidden="true" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
              <rect x="3" y="10" width="5" height="10" rx="0.8"></rect>
              <rect x="10" y="6" width="4" height="14" rx="0.8"></rect>
              <rect x="16" y="3" width="5" height="17" rx="0.8"></rect>
              <path d="M3 10 L10 6 L16 3" />
              <path d="M8 20 L14 20 L21 20" />
            </svg>
            <span class="title" data-i18n="app_modal_title">The Modal Architect</span>
            <span class="meta" data-i18n="app_modal_meta">Design harmonic structures from scale geometry.</span>
          </a>
        </li>

        <!-- POLYRHYTHM FORGE -->
        <li>
          <a class="item" href="polyrhythm-forge.html">
            <svg class="icon" viewBox="0 0 24 24" aria-hidden="true" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="8.5" />
              <circle cx="12" cy="12" r="5.5" />
              <circle cx="12" cy="12" r="2.5" />
              <line x1="12" y1="12" x2="12" y2="3.5" />
              <circle cx="12" cy="3.5" r="1.1" fill="currentColor" stroke="none"/>
              <circle cx="19.5" cy="12" r="0.9" fill="currentColor" stroke="none"/>
              <circle cx="12" cy="20.5" r="0.9" fill="currentColor" stroke="none"/>
              <circle cx="4.5" cy="12" r="0.9" fill="currentColor" stroke="none"/>
            </svg>
            <span class="title" data-i18n="app_poly_title">The Polyrhythm Forge</span>
            <span class="meta" data-i18n="app_poly_meta">Concentric rings for polyrhythms & polymeters — Mesh-ish grooves, Euclidean accents, swing & pan.</span>
          </a>
        </li>

      </ul>
    </nav>

    <footer>
      <a class="btn" href="https://buymeacoffee.com/Contumance" 
        target="_blank" rel="noopener noreferrer"
         aria-label="Support this library on Buy Me a Coffee">
        
        <svg class="btn-icon" viewBox="0 0 24 24" aria-hidden="true" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <path d="M4 8h14.5a2 2 0 0 1 0 4H18l-1 5a4 4 0 0 1-3.95 3.3H8.95A4 4 0 0 1 5 17l-1-9z"/>
          <path d="M3 8h17"/>
          <path d="M7 4h6"/>
        </svg>
        <span data-i18n="buyme">Buy me a coffee</span>
      </a>
      <span class="note">Fuel the craft. Inspire the next page.</span>
      <span>© <span id="y"></span> Re:sonance <small class="byline">by <em>Contumance</em></small></span>
    </footer>
  </main>

  <script>
  // --- I18N (primero) ---
  (function(){
    const LANG_KEY = 'resonance-lang';
    const qs = new URLSearchParams(location.search);
    const supported = ['en','es','pt'];

    const messages = {
      en: {
        doc_title: "Re:sonance — A quiet selection for curious hands.",
        doc_description: "Re:sonance — An experimental library of sound, color, and quiet motion. Paths of vibration that awaken new forms of listening.",
        tagline: "A quiet selection for curious hands.",
        collection: "Collection",
        app_scales_title: "The Scales Book",
        app_scales_meta: "Paths that guide the hand toward unseen colors.",
        app_chords_title: "The Chords Book",
        app_chords_meta: "Forms of resonance across the strings.",
        app_daily_title: "The Daily Chord",
        app_daily_meta: "Each day, a chord — seen anew, to awaken inspiration.",
        app_bounce_title: "The Bounce Garden",
        app_bounce_meta: "Where collisions sing — melodic orbits and rhythmic echoes within a circle.",
        app_modal_title: "The Modal Architect",
        app_modal_meta: "Design harmonic structures from scale geometry.",
        app_poly_title: "The Polyrhythm Forge",
        app_poly_meta: "Concentric rings for polyrhythms & polymeters — Mesh-ish grooves, Euclidean accents, swing & pan.",
        buyme: "Buy me a coffee",
        buyme_aria: "Support this library on Buy Me a Coffee",
        footer_note: "Fuel the craft. Inspire the next page.",
        lang_label: "Language",
        theme_to_light: "Switch to light mode",
        theme_to_dark: "Switch to dark mode"
      },
      es: {
        doc_title: "Re:sonance — Una selección silenciosa para manos curiosas.",
        doc_description: "Re:sonance — Una biblioteca experimental de sonido, color y movimiento sutil. Senderos de vibración que despiertan nuevas formas de escuchar.",
        tagline: "Una selección silenciosa para manos curiosas.",
        collection: "Colección",
        app_scales_title: "The Scales Book",
        app_scales_meta: "Caminos que guían la mano hacia colores invisibles.",
        app_chords_title: "The Chords Book",
        app_chords_meta: "Formas de resonancia a lo largo de las cuerdas.",
        app_daily_title: "The Daily Chord",
        app_daily_meta: "Cada día, un acorde — visto de nuevo, para despertar inspiración.",
        app_bounce_title: "The Bounce Garden",
        app_bounce_meta: "Donde las colisiones cantan — órbitas melódicas y ecos rítmicos dentro de un círculo.",
        app_modal_title: "The Modal Architect",
        app_modal_meta: "Diseña estructuras armónicas desde la geometría de las escalas.",
        app_poly_title: "The Polyrhythm Forge",
        app_poly_meta: "Anillos concéntricos para polirritmos y polímetros — grooves tipo Mesh, acentos euclídeos, swing y paneo.",
        buyme: "Invítame un café",
        buyme_aria: "Apoya esta biblioteca en Buy Me a Coffee",
        footer_note: "Alimenta el oficio. Inspira la próxima página.",
        lang_label: "Idioma",
        theme_to_light: "Cambiar a modo claro",
        theme_to_dark: "Cambiar a modo oscuro"
      },
      pt: {
        doc_title: "Re:sonance — Uma seleção silenciosa para mãos curiosas.",
        doc_description: "Re:sonance — Uma biblioteca experimental de som, cor e movimento sutil. Caminhos de vibração que despertam novas formas de escutar.",
        tagline: "Uma seleção silenciosa para mãos curiosas.",
        collection: "Coleção",
        app_scales_title: "The Scales Book",
        app_scales_meta: "Caminhos que guiam a mão a cores invisíveis.",
        app_chords_title: "The Chords Book",
        app_chords_meta: "Formas de ressonância através das cordas.",
        app_daily_title: "The Daily Chord",
        app_daily_meta: "A cada dia, um acorde — visto de novo, para despertar inspiração.",
        app_bounce_title: "The Bounce Garden",
        app_bounce_meta: "Onde colisões cantam — órbitas melódicas e ecos rítmicos dentro de um círculo.",
        app_modal_title: "The Modal Architect",
        app_modal_meta: "Desenhe estruturas harmônicas a partir da geometria das escalas.",
        app_poly_title: "The Polyrhythm Forge",
        app_poly_meta: "Anéis concêntricos para polirritmos e polímetros — grooves tipo Mesh, acentos euclidianos, swing e pan.",
        buyme: "Pague-me um café",
        buyme_aria: "Apoie esta biblioteca no Buy Me a Coffee",
        footer_note: "Alimente o ofício. Inspire a próxima página.",
        lang_label: "Idioma",
        theme_to_light: "Alternar para modo claro",
        theme_to_dark: "Alternar para modo escuro"
      }
    };

    function tr(key, fallback){
      const dict = messages[currentLang] || messages.en;
      return (dict && dict[key]) || fallback || key;
    }
    window.tr = tr;

    function detectInitial(){
      const fromQuery = (qs.get('lang')||'').toLowerCase();
      if(supported.includes(fromQuery)) return fromQuery;
      const saved = localStorage.getItem(LANG_KEY);
      if(supported.includes(saved)) return saved;
      const nav = (navigator.languages && navigator.languages[0]) || navigator.language || 'en';
      const base = (nav||'en').slice(0,2).toLowerCase();
      return supported.includes(base)? base : 'en';
    }

    function applyI18n(){
      document.querySelectorAll('[data-i18n]').forEach(el=>{
        const key = el.getAttribute('data-i18n');
        if(key) el.textContent = tr(key, el.textContent);
      });

      document.querySelectorAll('[data-i18n-attr]').forEach(el=>{
        const keys = el.getAttribute('data-i18n-attr').split(',').map(s=>s.trim());
        const key = el.getAttribute('data-i18n'); // ahora sí debe existir
        const val = tr(key, el.getAttribute(keys[0]));
        keys.forEach(attr=> el.setAttribute(attr, val));
      });

      document.title = tr('doc_title', document.title);
      const metaDesc = document.querySelector('meta[name="description"]');
      if (metaDesc) metaDesc.setAttribute('content', tr('doc_description', metaDesc.getAttribute('content')));

      const langLabel = tr('lang_label','Language');
      const langSelect = document.getElementById('langSelect');
      if (langSelect){
        langSelect.setAttribute('aria-label', langLabel);
        langSelect.setAttribute('title', langLabel);
      }

      document.documentElement.setAttribute('lang', currentLang);
      document.documentElement.setAttribute('dir', 'ltr');
    }

    let currentLang = detectInitial();
    const select = document.getElementById('langSelect');
    if(select){ select.value = currentLang; }

    applyI18n();

    if(select){
      select.addEventListener('change', (e)=>{
        currentLang = e.target.value;
        localStorage.setItem(LANG_KEY, currentLang);
        applyI18n();
        const url = new URL(location.href);
        url.searchParams.set('lang', currentLang);
        window.history.replaceState({}, '', url);
      });
    }

    window.ReI18n = {
      get: ()=>currentLang,
      set: (lang)=>{
        if(!supported.includes(lang)) return;
        if(select){ select.value = lang; }
        currentLang = lang; localStorage.setItem(LANG_KEY, lang); applyI18n();
      },
      t: tr,
      supported
    };
  })();

  // --- THEME TOGGLE (después de i18n + con safeTr) ---
  (function(){
    const KEY='theme-preference';
    const root=document.documentElement;
    const btn=document.getElementById('themeToggle');
    const safeTr=(k,f)=> (window.tr ? window.tr(k,f) : (f||k));

    function setIcon(mode){
      if(!btn) return;
      btn.textContent = mode==='dark' ? '☀︎' : '☾';
      const label = mode==='dark'
        ? safeTr('theme_to_light', 'Switch to light mode')
        : safeTr('theme_to_dark', 'Switch to dark mode');
      btn.setAttribute('aria-label', label);
      btn.setAttribute('title', label);
    }
    function applyTheme(mode){
      root.classList.toggle('theme-dark', mode==='dark');
      setIcon(mode);
    }
    function getPreferred(){
      const saved=localStorage.getItem(KEY);
      if(saved==='light' || saved==='dark') return saved;
      return (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) ? 'dark' : 'light';
    }
    let current=getPreferred();
    applyTheme(current);

    if(btn){
      btn.addEventListener('click', ()=>{
        current = current==='dark' ? 'light' : 'dark';
        localStorage.setItem(KEY,current);
        applyTheme(current);
      });
    }
    const y=document.getElementById('y');
    if(y) y.textContent = new Date().getFullYear();
  })();
</script>
</body>
</html>